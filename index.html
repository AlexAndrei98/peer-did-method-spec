<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Peer DID Method Specification</title>
    <style>
        #instructions {
          border: dashed 1px black;
          padding: 1em;
          background-color:#d0d0d0;
        }
        .replace-me {
          font-style:italic;
          color:magenta
        }

    </style>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "ED",
        editors: [
          {
            name: "Daniel Hardman",
            url: "https://github.com/dhh1128",
            company: "Hyperledger Aries Project / Sovrin Foundation / Evernym",
            companyURL: "https://github.com/hyperledger/aries",
            mailto: "daniel.hardman@gmail.com"
          }
        ],
        authors: [
          {
            name: "Oskar Deventer",
            url: "https://github.com/Oskar-van-Deventer",
            company: "TNO",
            companyURL: "https://tno.nl"
          },
          {
            name: "Christian Lundkvist",
            url: "https://github.com/christianlundkvist",
            company: "ConsenSys",
            companyURL: "https://consensys.net"
          },
          {
            name: "Marton Csernai",
            url: "https://github.com/csmarc",
            company: "KILT",
            companyURL: "https://kilt.io"
          },
          {
            name: "Brent Zundel",
            url: "https://github.com/brentzundel",
            company: "Evernym",
            companyURL: "https://evernym.com"
          },
          {
            name: "Sam Curren",
            url: "https://github.com/TelegramSam",
            company: "Sovrin Foundation / Decentralized Identity Foundation",
            companyURL: "https://sovrin.org"
          },
          {
            name: "Mike Varley",
            url: "https://github.com/mavarley",
            company: "SecureKey",
            companyURL: "https://securekey.com"
          },
          {
            name: "Devin Fisher",
            url: "https://github.com/devin-fisher",
            company: "Evernym",
            companyURL: "https://evernym.com"
          },
          {
            name: "Tobias Looker",
            url: "https://github.com/tplooker",
            company: "Mattr",
            companyURL: "https://www.mattr.global"
          }
        ],
        processVersion: 2017,
        edDraftURI: "https://github.com/openssi/peer-did-method-spec",
        shortName: "peer-did-method",
        subtitle: "A blockchain-agnostic decentralized identifier method",
        github: "https://github.com/openssi/peer-did-method-spec",
        wg: "greater SSI community",
        pluralize: true
      };

    </script>
</head>
<body>

<section id='abstract'>
    <p>This document defines a "peer" <a href="https://w3c-ccg.github.io/did-spec/#specific-did-method-schemes"
        target="didspec">DID Method</a> that conforms to the <a href="https://w3c-ccg.github.io/did-spec/"
        target="didspec">DID Spec</a>. The method can be used independent of any central source of truth, and is
        intended to be cheap, fast, scalable, and secure. It is suitable for most private relationships between people,
        organizations, and things. We expect that peer-to-peer relationships in every blockchain ecosystem can benefit
        by offloading pairwise and n-wise relationships to peer DIDs.</p>
</section>

<section id='sotd'>
    <p>&nbsp;
    </p>
</section>

<section id="intro" class="informative" data-include="intro.html">
</section>

<section id="core" data-include="core.html">
</section>

<section id="diddocs" data-include="did-docs.html">
</section>

<section id="protocols" data-include="protocols.html">
</section>

<section class="informative appendix">
    <h2>Security Considerations</h2>
    <section>
        <h3>Secure communication</h3>
        <p>All the messages in this protocol (except for a connection invitation that requires no security, by design)
            must be sent encrypted, using the encryption format specified in <a target="aries"
            href="https://github.com/hyperledger/aries-rfcs/blob/master/features/0019-encryption-envelope/README.md">
            DIDComm's encryption envelope</a>. This gives strong guarantees about the confidentiality and integrity of
            exchanged data, regardless of the transport mechanism used to transmit the messages.</p>
    </section>
    <section>
        <h3>Proof of Control</h3>
        <p>Because peer DIDs are generated from an algorithm that includes the values of their initial public key(s)
            as input, they cannot be created without the creator controlling them. As mentioned earlier, this prevents
            man-in-the-middle attacks at the time of creation.
        </p>
    </section>
    <section>
        <h3>Entropy</h3>
        <p>
            Since keys must be created from keys generated by a secure random number generator, they are guaranteed
            to be unpredictable and globally unique at creation time.</p>
    </section>
    <section>
        <h3>Key Management</h3>
        <p>Keys used to control peer DIDs, or keys authorized to communicate and update the DID Docs
            for peer DIDs, should be managed according to best practices for DKMS, as described in
            <a target="aries" href="https://github.com/hyperledger/aries-rfcs/blob/master/concepts/0051-dkms/dkms-v4.md">
                the DKMS spec</a>.
        </p>
        <p><a target="sgl" href="https://evernym.github.io/sgl/docs/reference.html#rules">SGL rules</a> are powerful and
            flexible, and should be used to implement best practices.</p>
    </section>
</section>

<section class="informative appendix">
    <h2>Privacy Considerations</h2>
    <p>Peer DIDs should remain <a>pairwise</a> or <a>n-wise</a>, not be reused across relationships. This
        allows proper isolation to defeat correlation. It also enables granular exercise of sovereignty in a
        robust, <a target="_blank" href="https://medium.com/evernym/three-dimensions-of-identity-bc06ae4aec1c">
            multidimensional identity</a>.</p>
    <img src="pairwise.png"/>
    <section>
        <h3>Fingerprinting</h3>
        <p>The names of roles and the arrangement of rules in a peer DID doc could conceivably be used to create
        a sort of fingerprint of a sovereign domain, in much the same way that browser fingerprinting keys off
        individual uniqueness in combinations of browser+plugin+hardware configuration. To combat this problem, the
        following best practices are recommended:</p>
        <ul>
            <li>Choose rules from a standard inventory.</li>
            <li>Choose role names from a standard inventory.</li>
            <li>Only define keys that are relevant to a particular relationship.</li>
            <li>Never reuse <code>id</code>s for keys, rules, or service endpoints across DID docs.</li>
        </ul>
    </section>
</section>

<section class="informative appendix">
    <h2>Grafting</h2>
    <p>Because peer DIDs are globally unique at the moment of creation, their <a>numeric basis</a>
        will not exist on any other blockchain unless someone copies it there. Blockchain-based DID methods can
        therefore (redundantly) register a peer DID Doc using their own method. We call this process <dfn>grafting</dfn>.
        Grafting might be useful when a peer DID needs to be accepted as the submitter or target of a transaction on a
        blockchain, when a blockchain is used as a deaddrop for a peer DID, when it's important to use use existing DID
        tools that assume a global source of truth (e.g., <a href="https://github.com/decentralized-identity/universal-resolver"
        target="_blank">DIF's Universal Resolver</a>), or in other circumstances where a peer DID needs some form
        of partially public reference.</p>
    <p>Grafting can be done either by combining another DID method's prefix with peer DID's NSI (<code>
        "did:peer:1-F1220abcd1234" &mdash;> "did:xyz:1-F1220abcd1234"</code>), or by creating a child namespace for peer
        DIDs beneath another method (<code>"did:peer:1-F1220abcd1234" &mdash;> did:xyz:peer:1-F1220abcd1234"</code>).</p>
    <p>If a peer DID is registered and grafted into another DID namespace, using either method,
        the result is two DIDs with different namespaces, one peer and one anchored, each with
        its own DID Doc. A decision must be made about which DID is normative for the relationship,
        or whether both should continue to be used. If both will be used, it should be understood that
        the two DID Docs hold keys and other data for two different DIDs, regardless of the shared
        history of those DIDs. Ideally, there would be no difference between the DID Docs stored in each place,
        but even with the best intentions of the DID controller, differences may arise.</p>
</section>

<section class="informative appendix">
    <h2>Reference Implementations</h2>
    <p>The encryption envelop for DID Communication has three independent implementations&mdash;one in
        <a target="_blank" href="https://github.com/hyperledger/indy-sdk/blob/fbad7422/libindy/src/api/crypto.rs#L634">
            libindy</a>, one in
        <a target="_blank" href="https://github.com/bcgov/indy-catalyst/blob/bba2ef5c/agent/indy_catalyst_agent/wallet/crypto.py#L402">
            python with no Indy dependencies</a>, and one in
        <a target="_blank" href="https://github.com/dbluhm/indy-pack-unpack-js/blob/db9d83e4/index.js">
            javascript with no Indy dependencies</a>.</p>
    <p>The connection protocol that creates and registers peer DIDs, including support for DID resolution
        after forming a connection, has been fully implemented by
        half a dozen different organizations, as of March 2019. One of these organizations did not use
        libindy. The connection management protocols that allow update of DIDs are in various states of
        implementation. An up-to-date summary of implementation status, including links to the implementations,
        can be found in the
        <a target="_blank" href="https://github.com/hyperledger/indy-agent">indy-agent repo on github</a>.</p>
    <p>There is a formal test suite for the protocols as well, in the same github repo.</p>
</section>

<section class="informative appendix">
    <h2>Resources</h2>
    <p>Developers maintaining this spec and its reference implementations are often found on RocketChat at
        chat.hyperledger.org, #aries. You might also connect with them via the Hyperledger Aries mailing list at
        aries@lists.hyperledger.org, in Hyperledger and W3C working groups, or at the semi-annual Internet Identity
        Workshop conferences.</p>
</section>

</body>
</html>
